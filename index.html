<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login Supabase (essenziale)</title>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { font-family: system-ui, Arial; max-width: 520px; margin: 24px auto; padding: 0 12px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; }
    label { display:block; margin-top: 10px; }
    input { width: 100%; padding: 10px; margin-top: 6px; border: 1px solid #ddd; border-radius: 10px; }
    button { padding: 10px 14px; margin-top: 12px; cursor: pointer; border: 1px solid #ddd; border-radius: 10px; background: #fff; }
    pre { white-space: pre-wrap; background:#f7f7f7; padding:10px; border-radius:10px; border:1px solid #eee; min-height: 42px; }
  </style>
</head>
<body>
  <h2>Login Supabase</h2>

  <div class="card">
    <label>Email
      <input id="email" type="email" autocomplete="username" />
    </label>

    <label>Password
      <input id="password" type="password" autocomplete="current-password" />
    </label>

    <button id="btnLogin" type="button">Accedi</button>
    <button id="btnLogout" type="button">Logout</button>

    <div style="margin-top:10px; opacity:.75;">Stato</div>
    <pre id="out"></pre>
  </div>

  <script>
    // 1) Inserisci qui i tuoi valori
    const SUPABASE_URL = "https://ybzoitxmlkjmfeoodqlq.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inliem9pdHhtbGtqbWZlb29kcWxxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MTI2MTIsImV4cCI6MjA4NDM4ODYxMn0.3kV-SnYCjvNay2PjZpz-MA6PZFDS-ZeAgufFbk1ZR6M";

    const el = (id) => document.getElementById(id);
    const out = (msg) => el("out").textContent = String(msg);

    if (!window.supabase) {
      out("ERRORE: libreria Supabase non caricata (CDN).");
      throw new Error("Supabase UMD non presente");
    }

    // 2) Crea client
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 3) UI state
    async function refresh() {
      const { data, error } = await supabase.auth.getSession();
      if (error) { out("Errore getSession: " + error.message); return; }
      const session = data?.session;
      out(session ? ("LOGGATO: " + session.user.email) : "NON LOGGATO");
    }

    // 4) Login
    async function login() {
      const email = el("email").value.trim();
      const password = el("password").value;

      if (!email || !password) { out("Inserisci email e password."); return; }

      out("Login in corso...");
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) { out("Errore login: " + error.message); return; }
      out("Login OK: " + data.user.email);
    }

    // 5) Logout
    async function logout() {
      out("Logout in corso...");
      const { error } = await supabase.auth.signOut();
      if (error) { out("Errore logout: " + error.message); return; }
      out("Logout OK");
    }

    // Bind
    el("btnLogin").addEventListener("click", login);
    el("btnLogout").addEventListener("click", logout);

    // Aggiorna stato allâ€™avvio e ai cambi sessione
    supabase.auth.onAuthStateChange(() => refresh());
    refresh();
  </script>
</body>
</html>
